(()=>{"use strict";
// helpers
const $=s=>document.querySelector(s),$$=s=>document.querySelectorAll(s);
const cssset=(o)=>{const r=document.documentElement.style;r.setProperty("--bg",o.bg);r.setProperty("--bg2",o.bg2);r.setProperty("--panel",o.panel);r.setProperty("--accent",o.accent);r.setProperty("--orange",o.orange);r.setProperty("--muted",o.muted);document.documentElement.style.background=`linear-gradient(180deg,var(--bg),var(--bg2))`};
function setTheme(key){const map=window.SUN_THEMES[key]||window.SUN_THEMES.trust;cssset(map.palette);const pre=$("#sloganPre"),main=$("#sloganMain");pre.textContent=map.slogan.pre;main.textContent=map.slogan.main;main.classList.remove("visible");requestAnimationFrame(()=>main.classList.add("visible"));const vid=$("#heroVideo"),src=$("#heroSrc");if(src&&vid){src.src=map.video;vid.load();vid.play().catch(()=>{});}const fomoT=$("#fomoTitle");if(fomoT){const titles={young:"Smart Savings Solar Event",family:"Home Energy Boost Sale",mature:"Lifetime Value Solar Offer",trust:"Reliability & Assurance Sale",business:"Energy Efficiency Upgrade Event",ev:"EV Owners Promo",battery:"Home Backup Sale",newbuilds:"New Build Kickstart",summer:"Hot Seasonal Packages",rural:"Regional Reliability Offers"};fomoT.textContent=(titles[key]||titles.trust)+" — Limited Time";}
try{localStorage.setItem("suntechTheme",key);}catch(e){}}
function initThemes(){ $$(".theme-list button").forEach(b=>b.addEventListener("click",()=>setTheme(b.dataset.theme))); let saved="trust";try{const s=localStorage.getItem("suntechTheme");if(s&&window.SUN_THEMES[s])saved=s;}catch(e){} setTheme(saved);}
function initCarousel(){const imgs=[...$("#carousel").querySelectorAll("img")];let i=0;if(!imgs.length)return;setInterval(()=>{imgs[i].classList.remove("active");i=(i+1)%imgs.length;imgs[i].classList.add("active");},6000);}
// QQ logic
const fmt=n=>Number(n).toLocaleString();
function typewriter(el,lines,done){el.textContent="";let i=0;const tick=()=>{if(i>=lines.length){done&&done();return;}el.textContent+=lines[i++]+"\n";el.scrollTop=el.scrollHeight;setTimeout(tick,80);};tick();}
function calcPerformance(sel,usage,rate,fit){const PSH=4.0,loss=.8;let kw=6.6,batt=0;if(sel==="battery"){kw=0;batt=10;}else if(sel==="combo"){kw=6.6;batt=10;}
const dailySolar=kw*PSH*loss;const self=Math.min(dailySolar,usage);const exportKwh=Math.max(0,dailySolar-usage);const save= self*rate + exportKwh*fit;const annual=save*365;const reduction=Math.round(100*Math.min(1,(dailySolar/usage)));let price=0;if(sel==="panels")price=3700;if(sel==="battery")price=9000;if(sel==="combo")price=12000;const roi=price>0?(price/(annual||1)):0;return{daily:dailySolar.toFixed(1)+" kWh",annual:"$"+fmt(Math.round(annual)),self:self.toFixed(1)+" kWh",reduction:reduction+"%",roi:roi?roi.toFixed(1)+" yrs":"—"}}
function initQQ(){let selection=null;const termWrap=$("#qqTermWrap"),term=$("#qqTerm"),out=$("#qqOut"),oD=$("#oDaily"),oA=$("#oAnnual"),oS=$("#oSelf"),oR=$("#oSave");const usage=$("#qqUsage"),rate=$("#qqRate"),fit=$("#qqFiT"),file=$("#qqBillFile");$$(".qq .chip").forEach(c=>c.addEventListener("click",()=>{selection=c.dataset.type;termWrap.classList.remove("is-hidden");out.classList.add("is-hidden");const lines=["Parsing uploaded energy bill...","Detected usage: "+(usage.value||18)+" kWh/day","Feed-in tariff: $"+Number(fit.value||0.05).toFixed(2),"Grid rate: $"+Number(rate.value||0.28).toFixed(2),"","Calculating savings..."];typewriter(term,lines,()=>{});}));$("#qqCalc").addEventListener("click",()=>{const sel=selection||"panels";const res=calcPerformance(sel,Number(usage.value||18),Number(rate.value||0.28),Number(fit.value||0.05));oD.textContent=res.daily;oA.textContent=res.annual;oS.textContent=res.self;oR.textContent=res.reduction+" (ROI "+res.roi+")";out.classList.remove("is-hidden");});$("#fomoUploadBtn").addEventListener("click",()=>file.click());file.addEventListener("change",()=>{termWrap.classList.remove("is-hidden");const fname=file.files[0]?file.files[0].name:"energybill.pdf";typewriter(term,["Uploading "+fname+" ...","Running OCR...","Estimating usage profile..."],()=>{});});}
function initFactsPause(){const t=$("#facts");if(!t)return;let hov=false;t.addEventListener("mouseenter",()=>{t.style.animationPlayState="paused";});t.addEventListener("mouseleave",()=>{t.style.animationPlayState="running";});}
function initTestimonials(){const row=$("#tRow");if(!row)return;row.addEventListener("mouseenter",()=>{row.style.animationPlayState="paused"});row.addEventListener("mouseleave",()=>{row.style.animationPlayState="running"});}
document.addEventListener("DOMContentLoaded",()=>{initThemes();initCarousel();initQQ();initFactsPause();initTestimonials();});})();
